function addCountLi(e,t){"0"==$("#countChat"+e).text()?(0!=t?($("#countChat"+e).addClass("bg-warning"),$("#countChat"+e).removeClass("bg-info"),$("#liChat"+e).addClass("bg-success")):($("#countChat"+e).removeClass("bg-warning"),$("#countChat"+e).addClass("bg-info"),$("#liChat"+e).removeClass("bg-success")),$("#countChat"+e).text(t)):(0!=t?($("#countChat"+e).addClass("bg-warning"),$("#liChat"+e).addClass("bg-success"),$("#countChat"+e).removeClass("bg-info")):($("#countChat"+e).removeClass("bg-warning"),$("#countChat"+e).addClass("bg-info"),$("#liChat"+e).removeClass("bg-success")),$("#countChat"+e).text(t))}function openChat(e){socket.emit("request",{chat:e}),socket.emit("seen",{phone:e}),addCountLi(e.split("@")[0],0),statusSale="0",$("#close_sale").prop("disabled",!0),$("#option_sale").removeClass("btn-danger"),$("#option_sale").addClass("btn-success"),$("#option_sale").text("Abrir una venta."),chatActive=e,chargeClient(e),getResponsesFast(),$("#openchat-btn").click()}function chargeClient(e){$.ajax({url:"/api/client/"+e,method:"GET",dataType:"json",success:function(t){if(null!=t){$(".client_location").val(""==t.CliLocation||null==t.CliLocation?"":t.CliLocation),$(".client_name").val(""==t.CliName||null==t.CliName?"":t.CliName),$(".client_address").val(""==t.CliAddress||null==t.CliAddress?"":t.CliAddress),$(".client_zone").val(""==t.CliZone||null==t.CliZone?"":t.CliZone),$(".client_observations").val(""==t.CliObservation||null==t.CliObservation?"":t.CliObservation),$(".client_id").val(""==t.CliId||null==t.CliId?"":t.CliId),$(".client_phone").val(""==t.CliPhone||null==t.CliPhone?"":t.CliPhone),$(".client_location").text(""==t.CliLocation||null==t.CliLocation?"":t.CliLocation),$(".client_name").text(""==t.CliName||null==t.CliName?"No se ha registrado.":t.CliName),$(".client_address").text(""==t.CliAddress||null==t.CliAddress?"No se ha registrado.":t.CliAddress),$(".client_zone").text(""==t.CliZone||null==t.CliZone?"":t.CliZone),$(".client_observations").text(""==t.CliObservation||null==t.CliObservation?"":t.CliObservation),$(".client_id").text(""==t.CliId||null==t.CliId?"Usuario no registrado.":t.CliId);var a="",s=0;null!=t.CliAddressExtra&&(t.CliAddressExtra=JSON.parse(t.CliAddressExtra),t.CliAddressExtra.forEach(e=>{a+="<option>"+e+"</option>",s++})),0!=s?$("#client-extra-address-small").text("Este cliente tiene direcciones "+s+" disponibles."):$("#client-extra-address-small").text(""),"/"!=route?($(".extra-address-select").html(a),$(".extra-address-select").val(0)):$(".extra-address-select").html(a),"/"==route&&verifyStatusSale(e)}else $(".client_name").val(""),$(".client_location").val(""),$(".client_address").val(""),$(".client_observations").val(""),$(".client_id").val(""),$("#client-extra-address-small").text(""),$(".extra-address-select").html(""),$(".client_zone").val(""),$(".client_zone").text(""),$(".client_name").text("Desconocido"),$(".client_location").text("Desconocido"),$(".client_address").text("Desconocido"),$(".client_observations").text("Desconocido"),$(".client_id").text("Desconocido");$("#edit-client-chat-view").prop("disabled",!1)},error:function(e,t,a){toastr.error(a)}})}function sendMessage(){const e=document.getElementById("message-input-server"),t=e.value.trim();""!==t&&""!=chatActive&&(socket.emit("message",{type:"sms",phone:chatActive,body:t}),e.value="")}function waitFile(){toastr.warning("Estamos descargando el archivo para que usted pueda tenerlo, sea paciente.")}function closeSale(){const e=$("#msg-add-delivery").val(),t=$("#select-delivery").val(),a=$("#resume-close-buy").val();let s=$("#select-address").val();const i=e.trim(),o=a.trim();if("0"!=chatActive&&"0"!=t&&"-1"!=t&&""!=t&&null!=t){if("-1"==s){const e=$("#address-custom-temp").val(),a=e.trim();""!=a?(socket.emit("close_sale",{delivery:t,body:i,client:chatActive,resume:o,address:a}),$("#select-delivery").val("-1").trigger("change"),$("#msg-add-delivery").val(""),$("#select-address").val("0"),$("#resume-close-buy").val(""),statusSale="0",$("#close_sale").prop("disabled",!0),$("#option_sale").removeClass("btn-danger"),$("#option_sale").addClass("btn-success"),$("#option_sale").text("Abrir una venta."),closeModalBootstrap.hide(),$("#liChat"+chatActive.split("@")[0]).removeClass("bg-warning"),toastr.success("Venta cerrada con exito.")):toastr.error("Pon una dirección por favor.")}else null!=s&""!=s?(s=s==$(".client_address").val()?"0":s,socket.emit("close_sale",{delivery:t,body:i,client:chatActive,resume:o,address:s}),$("#select-delivery").val("-1").trigger("change"),$("#msg-add-delivery").val(""),$("#select-address").val("0"),$("#resume-close-buy").val(""),statusSale="0",$("#close_sale").prop("disabled",!0),$("#option_sale").removeClass("btn-danger"),$("#option_sale").addClass("btn-success"),$("#option_sale").text("Abrir una venta."),closeModalBootstrap.hide(),$("#liChat"+chatActive.split("@")[0]).removeClass("bg-warning"),toastr.success("Venta cerrada con exito.")):toastr.error("Pon una dirección por favor.");closeModalBootstrap.hide()}else"0"!=chatActive&&"0"==t?(socket.emit("close_sale_pick_up",{client:chatActive,resume:o,body:i}),$("#select-delivery").val("-1").trigger("change"),$("#msg-add-delivery").val(""),statusSale="0",$("#resume-close-buy").val(""),$("#close_sale").prop("disabled",!0),$("#option_sale").removeClass("btn-danger"),$("#option_sale").addClass("btn-success"),$("#option_sale").text("Abrir una venta."),closeModalBootstrap.hide(),$("#liChat"+chatActive.split("@")[0]).removeClass("bg-warning"),toastr.success("Venta cerrada con exito.")):toastr.error("Faltan datos para cancelar la venta.")}function setRecord(e){var t="";for(let a=0;a<e.length;a++)t+='<li id="liChat'+e[a].CliPhone.split("@")[0]+'" class="'+(null!=e[a].SaleStatus?"bg-warning":null)+" "+(0==e[a].UnreadCount?null:"bg-success")+'" onclick="openChat(\''+e[a].CliPhone+'\')" ><a href="#"><img class="contacts-list-img" src="'+(null!=e[a].CliImg?e[a].CliImg:"/dist/img/AdminLTELogo.png")+'" alt="User Avatar"><div class="contacts-list-info" bis_skin_checked="1"><span class="contacts-list-name">'+e[a].CliName+'<small class="contacts-list-date float-right">'+formatFecha(e[a].CliDate)+'</small><span style="margin-left:10px;" id="countChat'+e[a].CliPhone.split("@")[0]+'" title="Mensajes sin ver" class="badge bg-'+(0==e[a].UnreadCount?"info":"warning")+'">'+e[a].UnreadCount+'</span></span><span class="contacts-list-msg" id="chat'+e[a].CliPhone.split("@")[0]+'">'+e[a].CliLastMessage+".</span></div></a></li>";$("#contacts_list").html(t)}async function logout(){try{const e=await fetch("/api/admin/logout",{method:"POST",headers:{"Content-Type":"application/json"}});e.ok?window.location.href="/Login":console.error("Error al cerrar sesión:",e.status)}catch(e){console.error("Error en la solicitud de logout:",e)}}function editClient(){$.ajax({url:"/api/client",method:"POST",dataType:"json",data:{CliId:$("#edit_client_id").val(),CliName:$("#edit_client_name").val(),CliAddress:$("#edit_client_address").val(),CliZone:$("#edit_client_zone").val(),CliObservation:$("#edit_client_observation").val(),CliLocation:$("#edit_client_location").val(),CliPhone:"/client"==route||"/Client"==route?$("#edit_client_phone").val():chatActive},success:function(e){toastr.success(e),"/client"==route||"/Client"==route?window.location.href="/client":chargeClient(chatActive)},error:function(e,t,a){toastr.error(a)}})}function getResponsesFast(){$.ajax({url:"/api/responses/compile",method:"POST",dataType:"json",data:{phone:chatActive},success:function(e){if(0!=e.length){var t="";for(let a=0;a<e.length;a++){const s=e[a];t+='<div class="col-md-3 div-response"><span data-response="'+s.ResResponse+'" class="btn btn-secondary btn-sm btn-response">'+s.ResTitle+"</span></div>"}$("#content-responses-charge").html(t),$(".btn-response").click(function(){if("0"!=chatActive){const e=$(this).attr("data-response");$("#message-input-server").val(e)}})}},error:function(e,t,a){toastr.error(a)}})}function setLogoutWhatsapp(){socket.emit("close",{token:!0})}function soundNotify(){var e=new Audio("/sounds/notification.mp3");e.play()}function formatFecha(e){const t=new Date(e),a=t.getFullYear(),s=String(t.getMonth()+1).padStart(2,"0"),i=String(t.getDate()).padStart(2,"0"),o=String(t.getHours()%12||12).padStart(2,"0"),c=String(t.getMinutes()).padStart(2,"0"),n=t.getHours()>=12?"pm":"am";return`${a}-${s}-${i} ${o}:${c} ${n}`}function openSale(){$("#reason-cancel").val(""),"Cancelar venta."!=$("#option_sale").text()?($("#close_sale").prop("disabled",!1),$("#option_sale").removeClass("btn-success"),$("#option_sale").addClass("btn-danger"),$("#option_sale").text("Cancelar venta."),"0"==statusSale&&$.ajax({url:"/api/sale",method:"POST",dataType:"json",data:{phone:chatActive,admin:$("#token_admin").val()},success:function(e){statusSale=e,$("#liChat"+chatActive.split("@")[0]).addClass("bg-warning")},error:function(e,t,a){toastr.error(a),$("#close_sale").prop("disabled",!0),$("#option_sale").removeClass("btn-danger"),$("#option_sale").addClass("btn-success"),$("#option_sale").text("Abrir una venta.")}})):(closeModalSaleBootstrap.show(),$("#close_sale").prop("disabled",!0),$("#option_sale").removeClass("btn-danger"),$("#option_sale").addClass("btn-success"),$("#option_sale").text("Abrir una venta."))}function verifyStatusSale(e){$.ajax({url:"/api/sale/"+e,method:"GET",dataType:"json",success:function(e){null!=e&&0!=e.length?($("#close_sale").prop("disabled",!1),$("#option_sale").removeClass("btn-success"),$("#option_sale").addClass("btn-danger"),$("#option_sale").text("Cancelar venta.")):($("#close_sale").prop("disabled",!0),$("#option_sale").removeClass("btn-danger"),$("#option_sale").addClass("btn-success"),$("#option_sale").text("Abrir una venta."))},error:function(e,t,a){toastr.error(a),$("#close_sale").prop("disabled",!0),$("#option_sale").removeClass("btn-danger"),$("#option_sale").addClass("btn-success"),$("#option_sale").text("Abrir una venta.")}})}function cancelSale(){const e=$("#reason-cancel").val();e.length>=5&&e.length<=256?$.ajax({url:"/api/sale/cancel",method:"POST",dataType:"json",data:{phone:chatActive,reason:e},success:function(t){statusSale="0",$("#liChat"+chatActive.split("@")[0]).removeClass("bg-warning"),closeModalSaleBootstrap.hide(),$("#reason-cancel").val(""),toastr.success("Venta cancelada por <b>"+(""==e?"motivo no especificado.":e)+"</b>")},error:function(e,t,a){toastr.error(a),$("#close_sale").prop("disabled",!1),$("#option_sale").removeClass("btn-success"),$("#option_sale").addClass("btn-danger"),$("#option_sale").text("Cancelar venta.")}}):toastr.warning("El campo de motivo es obligatorio, por favor escribe un motivo mayor a 5 caracteres y menor a 256 caracteres.")}function deleteExtraAddress(){const e=$("#extra-address-select-delete").val();"0"!=e&&"-1"!=e?$.ajax({url:"/api/client/address",method:"POST",dataType:"json",data:{client:chatActive,delete:e},success:function(e){toastr.success("Dirección extra eliminada."),"/"!=route&&(dataClientChange=1),chargeClient(chatActive)},error:function(e,t,a){toastr.error(a)}}):toastr.warning("No ha seleccionado una dirección extra válida.")}function addExtraAddress(){const e=$("#extra-add-client").val();e.length>5?$.ajax({url:"/api/client/address",method:"POST",dataType:"json",data:{client:chatActive,add:e},success:function(e){toastr.success("Dirección extra agregada."),$("#extra-add-client-div").hide(),$("#extra-add-client").val(""),"/"!=route&&(dataClientChange=1),chargeClient(chatActive)},error:function(e,t,a){toastr.error(a)}}):toastr.warning("La dirección extra debe contener más de 5 caracteres.")}function requestType(){closeModalBootstrap.hide(),Swal.fire({title:"¿Qué tipo de pedido es?",text:"¡Domicilio o Pick UP!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#EC8F09",cancelButtonColor:"#1C9300",cancelButtonText:"PickUp",confirmButtonText:"Domicilio"}).then(e=>{if(e.isConfirmed){const e=$(".client_zone").val(),t=$(".client_location").val(),a=$(".client_address").val();""!=e&&""!=t&&""!=a&&"Desconocido"!=e&&"Desconocido"!=t&&"Desconocido"!=a?($("#type_dom_close").text("Repartidor."),$("#select-delivery").prop("disabled",!1),$("#select-delivery").val("").trigger("change"),hideOption(),$("#type_dom_address").show(),closeModalBootstrap.show()):toastr.error("Primero registra una dirección, una zona y link de ubicacion.")}else reverseHideOption(),$("#address-div-custom-temp").hide(),$("#address-custom-temp").val(""),$("#select-address").val("0").trigger("change"),$("#type_dom_close").text("Tipo de entrega."),$("#select-delivery").val("0").trigger("change"),$("#select-delivery").prop("disabled",!0),$("#type_dom_address").hide(),closeModalBootstrap.show()})}function hideOption(){$('#select-delivery option[value="0"]').remove(),updateSelectType()}function reverseHideOption(){var e=new Option("Recoger en local",0);$("#select-delivery").append(e),updateSelectType()}function updateSelectType(){$("#select-delivery").select2({theme:"bootstrap4"})}function moveContact(e){var t=$(e),a=t.parent();t.detach(),a.prepend(t)}function closeDay(){$("#maximus-chat-option").click(),$(".close_day_class").hide(),$("#body_close_day").removeClass("none"),$("#card_body_close_day").addClass("row"),$("#direct-chat-view").addClass("col-md-6"),$(".direct-chat-contacts").hide(),$.ajax({url:"/api/temp",method:"GET",dataType:"json",success:function(e){console.log(e),0!=e.length?(resumeDay=e,openChat(e[0].TempClient),$("#chats_no_converse").text(e.length+""),1!=e.length?$("#next_btn_resume").attr("onclick","nextResume(1)"):$("#next_btn_resume").attr("onclick","finishResume(1)")):($("#direct-chat-view").html(""),$(".client_name").text(""),$(".client_location").text(""),$(".client_address").text(""),$(".client_observations").text(""),$(".client_id").text(""),toastr.info("<b>Servidor:</b> No hay nigun chat que cumpla las condiciones del cierre de dia."),$("#next_btn_resume").attr("onclick","finishResume(0)"),$("#next_btn_resume").text("Finalizar"))},error:function(e,t,a){console.log(a),toastr.error(a)}})}function nextResume(e){toastr.info("<b>Servidor:</b> Cargando datos del siguiente chat no convertido."),indexResumeDay=e;const t="Otro"==$("#resume_type_reason").val()?$("#resume_type_reason_textarea").val():$("#resume_type_reason").val();t.length>5&&$.ajax({url:"/api/temp/active",method:"POST",data:{TempClient:resumeDay[e-1].TempClient,TempReason:t},dataType:"json",success:function(t){if(t.ok)try{openChat(t[e].TempClient),$("#next_btn_resume").attr("onclick","nextResume("+(e+1)+")")}catch(t){$("#next_btn_resume").attr("onclick","finishResume("+(e+1)+")"),$("#next_btn_resume").text("Finalizar")}},error:function(e,t,a){console.log(a),toastr.error(a)}})}function finishResume(e){if(0==e)$("#next_btn_resume").hide(),$("#cancel_btn_resume").hide(),socket.emit("resume",{cant:resumeDay.length}),window.location.href="/";else{indexResumeDay=e;const t="Otro"==$("#resume_type_reason").val()?$("#resume_type_reason_textarea").val():$("#resume_type_reason").val();t.length>3&&$.ajax({url:"/api/temp/active",method:"POST",data:{TempClient:resumeDay[e-1].TempClient,TempReason:t},dataType:"json",success:function(e){e.ok&&($("#next_btn_resume").hide(),$("#cancel_btn_resume").hide(),socket.emit("resume",{cant:resumeDay.length}),window.location.href="/")},error:function(e,t,a){console.log(a),toastr.error(a)}})}}const myModal=document.getElementById("modal-xl"),modal=new bootstrap.Modal(myModal);modal._config.backdrop="static";const closeModal=document.getElementById("closeModal"),closeModalBootstrap=new bootstrap.Modal(closeModal);closeModalBootstrap._config.backdrop="static";const closeSaleModal=document.getElementById("closeModal2"),closeModalSaleBootstrap=new bootstrap.Modal(closeSaleModal);closeModalSaleBootstrap._config.backdrop="static";const editClientModal=document.getElementById("editClient"),editClientModalBootstrap=new bootstrap.Modal(editClientModal);editClientModalBootstrap._config.backdrop="static";const route=window.location.pathname,selectBtn=document.getElementById("input-file-send-button"),fileInput=document.getElementById("input-file-send");let chatActive="0",statusSale="0",dataClientChange=0,resumeDay=[],indexResumeDay=0;"/"==route&&modal.show(),"/client"!=route&&"/Client"!=route&&"/Interacciones"!=route&&"/interacciones"!=route&&"/delivers"!=route&&"/Delivers"!=route&&"/Sales"!=route&&"/sales"!=route&&"/Schedule"!=route&&"/schedule"!=route&&"/Temp"!=route&&"/temp"!=route||$(function(){$(document).ready(function(){$("#example1").DataTable({paging:!0,lengthChange:!1,searching:!0,ordering:!0,info:!0,autoWidth:!1,responsive:!0,buttons:["copy","csv","excel","pdf","print","colvis"],language:{processing:"Procesando...",lengthMenu:"Mostrar _MENU_ registros",zeroRecords:"No se encontraron resultados",emptyTable:"Ningún dato disponible en esta tabla",infoEmpty:"Mostrando registros del 0 al 0 de un total de 0 registros",infoFiltered:"(filtrado de un total de _MAX_ registros)",search:"Buscar:",infoThousands:",",loadingRecords:"Cargando...",paginate:{first:"Primero",last:"Último",next:"Siguiente",previous:"Anterior"},aria:{sortAscending:": Activar para ordenar la columna de manera ascendente",sortDescending:": Activar para ordenar la columna de manera descendente"},buttons:{copy:"Copiar",colvis:"Visibilidad",collection:"Colección",colvisRestore:"Restaurar visibilidad",copyKeys:"Presione ctrl o u2318 + C para copiar los datos de la tabla al portapapeles del sistema. <br /> <br /> Para cancelar, haga clic en este mensaje o presione escape.",copySuccess:{1:"Copiada 1 fila al portapapeles",_:"Copiadas %ds fila al portapapeles"},copyTitle:"Copiar al portapapeles",csv:"CSV",excel:"Excel",pageLength:{"-1":"Mostrar todas las filas",_:"Mostrar %d filas"},pdf:"PDF",print:"Imprimir",renameState:"Cambiar nombre",updateState:"Actualizar"},autoFill:{cancel:"Cancelar",fill:"Rellene todas las celdas con <i>%d</i>",fillHorizontal:"Rellenar celdas horizontalmente",fillVertical:"Rellenar celdas verticalmentemente"},decimal:",",searchBuilder:{add:"Añadir condición",button:{0:"Constructor de búsqueda",_:"Constructor de búsqueda (%d)"},clearAll:"Borrar todo",condition:"Condición",conditions:{date:{after:"Despues",before:"Antes",between:"Entre",empty:"Vacío",equals:"Igual a",notBetween:"No entre",notEmpty:"No Vacio",not:"Diferente de"},number:{between:"Entre",empty:"Vacio",equals:"Igual a",gt:"Mayor a",gte:"Mayor o igual a",lt:"Menor que",lte:"Menor o igual que",notBetween:"No entre",notEmpty:"No vacío",not:"Diferente de"},string:{contains:"Contiene",empty:"Vacío",endsWith:"Termina en",equals:"Igual a",notEmpty:"No Vacio",startsWith:"Empieza con",not:"Diferente de",notContains:"No Contiene",notStarts:"No empieza con",notEnds:"No termina con"},array:{not:"Diferente de",equals:"Igual",empty:"Vacío",contains:"Contiene",notEmpty:"No Vacío",without:"Sin"}},data:"Data",deleteTitle:"Eliminar regla de filtrado",leftTitle:"Criterios anulados",logicAnd:"Y",logicOr:"O",rightTitle:"Criterios de sangría",title:{0:"Constructor de búsqueda",_:"Constructor de búsqueda (%d)"},value:"Valor"},searchPanes:{clearMessage:"Borrar todo",collapse:{0:"Paneles de búsqueda",_:"Paneles de búsqueda (%d)"},count:"{total}",countFiltered:"{shown} ({total})",emptyPanes:"Sin paneles de búsqueda",loadMessage:"Cargando paneles de búsqueda",title:"Filtros Activos - %d",showMessage:"Mostrar Todo",collapseMessage:"Colapsar Todo"},select:{cells:{1:"1 celda seleccionada",_:"%d celdas seleccionadas"},columns:{1:"1 columna seleccionada",_:"%d columnas seleccionadas"},rows:{1:"1 fila seleccionada",_:"%d filas seleccionadas"}},thousands:".",datetime:{previous:"Anterior",next:"Proximo",hours:"Horas",minutes:"Minutos",seconds:"Segundos",unknown:"-",amPm:["AM","PM"],months:{0:"Enero",1:"Febrero",10:"Noviembre",11:"Diciembre",2:"Marzo",3:"Abril",4:"Mayo",5:"Junio",6:"Julio",7:"Agosto",8:"Septiembre",9:"Octubre"},weekdays:["Dom","Lun","Mar","Mie","Jue","Vie","Sab"]},editor:{close:"Cerrar",create:{button:"Nuevo",title:"Crear Nuevo Registro",submit:"Crear"},edit:{button:"Editar",title:"Editar Registro",submit:"Actualizar"},remove:{button:"Eliminar",title:"Eliminar Registro",submit:"Eliminar",confirm:{_:"¿Está seguro que desea eliminar %d filas?",1:"¿Está seguro que desea eliminar 1 fila?"}},error:{system:'Ha ocurrido un error en el sistema (<a target="\\" rel="\\ nofollow" href="\\">Más información&lt;\\/a&gt;).</a>'},multi:{title:"Múltiples Valores",info:"Los elementos seleccionados contienen diferentes valores para este registro. Para editar y establecer todos los elementos de este registro con el mismo valor, hacer click o tap aquí, de lo contrario conservarán sus valores individuales.",restore:"Deshacer Cambios",noMulti:"Este registro puede ser editado individualmente, pero no como parte de un grupo."}},info:"Mostrando _START_ a _END_ de _TOTAL_ registros",stateRestore:{creationModal:{button:"Crear",name:"Nombre:",order:"Clasificación",paging:"Paginación",search:"Busqueda",select:"Seleccionar"},emptyError:"El nombre no puede estar vacio",removeConfirm:"¿Seguro que quiere eliminar este %s?",removeError:"Error al eliminar el registro",removeJoiner:"y",removeSubmit:"Eliminar",renameButton:"Cambiar Nombre",renameLabel:"Nuevo nombre para %s"}}}).buttons().container().appendTo("#example1_wrapper .col-md-6:eq(0)")})}),$(".select2").select2({theme:"bootstrap4"}),$("#btn-send-server").click(function(){sendMessage()}),$("#message-input-server").keypress(function(e){13===e.which&&sendMessage()});const socket=io();socket.on("qr_code",e=>{console.log(e),$("#qr_code").attr("src",e.body.replace('"',"").replace('"',""))}),socket.on("message",e=>{if(console.log(e),e.phone==chatActive){var t="";"sms"==e.type?t='<div class="direct-chat-msg" bis_skin_checked="1"><div class="direct-chat-infos clearfix" bis_skin_checked="1"><span class="direct-chat-name float-right">'+e.name+'</span><span class="direct-chat-timestamp float-left">'+formatFecha(new Date)+'</span></div><img class="direct-chat-img" src="'+e.img+'" alt="Message User Image"><div class="direct-chat-text" bis_skin_checked="1">'+e.body+"</div></div>":"image"==e.type?t='<div class="direct-chat-msg" bis_skin_checked="1"><div class="direct-chat-infos clearfix" bis_skin_checked="1"><span class="direct-chat-name float-left">'+e.name+'</span><span class="direct-chat-timestamp float-right">'+formatFecha(new Date)+'</span></div><img class="direct-chat-img" src="'+e.img+'" alt="Message User Image"><div class="direct-chat-text" bis_skin_checked="1"><img src="'+msg.body+'" width="100%" alt="Imagen"></div></div>':"document"==e.type?t='<div class="direct-chat-msg" bis_skin_checked="1"><div class="direct-chat-infos clearfix" bis_skin_checked="1"><span class="direct-chat-name float-left">'+e.name+'</span><span class="direct-chat-timestamp float-right">'+formatFecha(new Date)+'</span></div><img class="direct-chat-img" src="'+e.img+'" alt="Message User Image"><div class="direct-chat-text" bis_skin_checked="1"><a href="'+e.body+'" download="'+e.nameFile+'" class="btn btn-success">Descargar documento (Documento.pdf).</a></div></div>':"audio"==e.type&&(t='<div class="direct-chat-msg" bis_skin_checked="1"><div class="direct-chat-infos clearfix" bis_skin_checked="1"><span class="direct-chat-name float-left">'+e.name+'</span><span class="direct-chat-timestamp float-right">'+formatFecha(new Date)+'</span></div><img class="direct-chat-img" src="'+e.img+'" alt="Message User Image"><div class="direct-chat-text" bis_skin_checked="1"><div ><audio style="width: 100%;" controls><source src="'+e.body+'" type="audio/mpeg">Su navegador no es compatible con el elemento de audio.</audio></div></div></div>'),$("#direct-chat-view").append(t).animate({scrollTop:$("#direct-chat-view").prop("scrollHeight")},500),socket.emit("seen",{phone:e.phone})}else if("server"==e.phone){if(e.client==chatActive){t="";"sms"==e.type?t='<div class="direct-chat-msg right" bis_skin_checked="1"><div class="direct-chat-infos clearfix" bis_skin_checked="1"><span class="direct-chat-name float-right">'+e.name+'</span><span class="direct-chat-timestamp float-left">'+formatFecha(new Date)+'</span></div><img class="direct-chat-img" src="'+e.img+'" alt="Message User Image"><div class="direct-chat-text" bis_skin_checked="1">'+e.body+"</div></div>":"image"==e.type?t='<div class="direct-chat-msg right" bis_skin_checked="1"><div class="direct-chat-infos clearfix" bis_skin_checked="1"><span class="direct-chat-name float-right">'+e.name+'</span><span class="direct-chat-timestamp float-left">'+formatFecha(new Date)+'</span></div><img class="direct-chat-img" src="'+e.img+'" alt="Message User Image"><div class="direct-chat-text" bis_skin_checked="1"><img src="'+e.body+'" width="100%" alt="Imagen"></div></div>':"document"==e.type?t='<div class="direct-chat-msg right" bis_skin_checked="1"><div class="direct-chat-infos clearfix" bis_skin_checked="1"><span class="direct-chat-name float-right">'+e.name+'</span><span class="direct-chat-timestamp float-left">'+formatFecha(new Date)+'</span></div><img class="direct-chat-img" src="'+e.img+'" alt="Message User Image"><div class="direct-chat-text" bis_skin_checked="1"><a href="'+e.body+'" download="archivo.pdf" class="btn btn-success">Descargar documento (Documento.pdf).</a></div></div>':"audio"==e.type&&(t+='<div class="direct-chat-msg right" bis_skin_checked="1"><div class="direct-chat-infos clearfix" bis_skin_checked="1"><span class="direct-chat-name float-right">'+e.name+'</span><span class="direct-chat-timestamp float-left">'+formatFecha(new Date)+'</span></div><img class="direct-chat-img" src="'+e.img+'" alt="Message User Image"><div class="direct-chat-text" bis_skin_checked="1"><div ><audio style="width: 100%;" controls><source src="'+e.body+'" type="audio/mpeg">Su navegador no es compatible con el elemento de audio.</audio></div></div></div>'),$("#direct-chat-view").append(t).animate({scrollTop:$("#direct-chat-view").prop("scrollHeight")},500),addCountLi(e.client.split("@")[0],e.UnreadCount)}}else"sms"==e.type?toastr.info("<b>"+e.name+":</b><br>"+e.body):"image"==e.type?toastr.info("<b>"+e.name+":</b><br>Te envio una imagen."):"document"==e.type?toastr.info("<b>"+e.name+":</b><br>Te envio un archivo."):"audio"==e.type&&toastr.info("<b>"+e.name+":</b><br>Te envio un audio."),addCountLi(e.phone.split("@")[0],e.UnreadCount);"sms"==e.type?($("#chat"+e.phone.split("@")[0]).text(e.body),moveContact("#liChat"+e.phone.split("@")[0]),soundNotify()):"image"==e.type?($("#chat"+e.phone.split("@")[0]).text("Te envio una imagen."),moveContact("#liChat"+e.phone.split("@")[0]),soundNotify()):"document"==e.type?($("#chat"+e.phone.split("@")[0]).text("Te envio un archivo."),moveContact("#liChat"+e.phone.split("@")[0]),soundNotify()):"audio"==e.type&&($("#chat"+e.phone.split("@")[0]).text("Te envio un audio."),moveContact("#liChat"+e.phone.split("@")[0]),soundNotify())}),socket.on("status",e=>{console.log(e),$(".status_bot").text(e.body),"Ok"==e.body?setTimeout(()=>{modal.hide()},3e3):"Estableciendo session."!=e.body&&"Desconectado"!=e.body||modal.show()}),socket.on("record",e=>{console.log(e),$("#status_new_sms").text(e.length),setRecord(e)}),socket.on("media",e=>{if(console.log(e),"image"==e.type)$("#"+e.id).prop("src",e.body);else if("document"==e.type)$("#"+e.id).attr("href",e.body),$("#"+e.id).attr("download",e.name);else if("ptt"==e.type){var t='<audio style="width: 100%;" controls><source src="'+e.body+'" type="audio/mpeg">Su navegador no es compatible con el elemento de audio.</audio>';$("#"+e.id).html(t)}}),socket.on("close",e=>{console.log(e)}),socket.on("background",e=>{console.log(e);var t="";for(let a=0;a<e.length;a++){const s=e[a],i=null!=s.sender.profilePicThumbObj&&"img"in s.sender.profilePicThumbObj?s.sender.profilePicThumbObj.img:"/dist/img/AdminLTELogo.png";s.fromMe||"e2e_notification"==s.type?"e2e_notification"!=s.type&&("location"==s.type?t+='<div class="direct-chat-msg right" bis_skin_checked="1"><div class="direct-chat-infos clearfix" bis_skin_checked="1"><span class="direct-chat-name float-right">'+s.sender.pushname+'</span><span class="direct-chat-timestamp float-left">'+formatFecha(new Date(1e3*s.timestamp))+'</span></div><img class="direct-chat-img" src="'+i+'" alt="Message User Image"><div class="direct-chat-text" bis_skin_checked="1"><a href="https://www.google.com/maps?q='+s.lat+","+s.lng+'" target="_blank">Ubicacion, click aqui para ver</a></div></div>':"chat"==s.type?t+='<div class="direct-chat-msg right" bis_skin_checked="1"><div class="direct-chat-infos clearfix" bis_skin_checked="1"><span class="direct-chat-name float-right">'+s.sender.pushname+'</span><span class="direct-chat-timestamp float-left">'+formatFecha(new Date(1e3*s.timestamp))+'</span></div><img class="direct-chat-img" src="'+i+'" alt="Message User Image"><div class="direct-chat-text" bis_skin_checked="1">'+s.body+"</div></div>":"image"==s.type?(t+='<div class="direct-chat-msg right" bis_skin_checked="1"><div class="direct-chat-infos clearfix" bis_skin_checked="1"><span class="direct-chat-name float-right">'+s.sender.pushname+'</span><span class="direct-chat-timestamp float-left">'+formatFecha(new Date(1e3*s.timestamp))+'</span></div><img class="direct-chat-img" src="'+i+'" alt="Message User Image"><div class="direct-chat-text" bis_skin_checked="1"><img id="i'+s.timestamp+'" src="data:image/jpeg;base64,'+s.body+'" width="100%" alt="Imagen"></div></div>',socket.emit("media",{msg:s.id,id:"i"+s.timestamp,type:s.type,name:"null"})):"document"==s.type?(t+='<div class="direct-chat-msg right" bis_skin_checked="1"><div class="direct-chat-infos clearfix" bis_skin_checked="1"><span class="direct-chat-name float-right">'+s.sender.pushname+'</span><span class="direct-chat-timestamp float-left">'+formatFecha(new Date(1e3*s.timestamp))+'</span></div><img class="direct-chat-img" src="'+i+'" alt="Message User Image"><div class="direct-chat-text" bis_skin_checked="1"><a href="javascript:waitFile()" id="i'+s.timestamp+'" class="btn btn-success">Descargar documento ('+s.filename+").</a></div></div>",socket.emit("media",{msg:s.id,id:"i"+s.timestamp,type:s.type,name:s.filename})):"ptt"==s.type?(t+='<div class="direct-chat-msg right" bis_skin_checked="1"><div class="direct-chat-infos clearfix" bis_skin_checked="1"><span class="direct-chat-name float-right">'+s.sender.pushname+'</span><span class="direct-chat-timestamp float-left">'+formatFecha(new Date(1e3*s.timestamp))+'</span></div><img class="direct-chat-img" src="'+i+'" alt="Message User Image"><div class="direct-chat-text" bis_skin_checked="1"><div id="i'+s.timestamp+'"><span class="btn btn-danger">Estamos cargando el audio para que puedas escucharlo.</span></div></div></div>',socket.emit("media",{msg:s.id,id:"i"+s.timestamp,type:s.type,name:"null"
})):"revoked"==s.type&&(t+='<div class="direct-chat-msg right" bis_skin_checked="1"><div class="direct-chat-infos clearfix" bis_skin_checked="1"><span class="direct-chat-name float-right">'+s.sender.pushname+'</span><span class="direct-chat-timestamp float-left">'+formatFecha(new Date(1e3*s.timestamp))+'</span></div><img class="direct-chat-img" src="'+i+'" alt="Message User Image"><div class="direct-chat-text" bis_skin_checked="1">Se elimino este mensaje</div></div>')):"location"==s.type?t+='<div class="direct-chat-msg" bis_skin_checked="1"><div class="direct-chat-infos clearfix" bis_skin_checked="1"><span class="direct-chat-name float-left">'+s.sender.pushname+'</span><span class="direct-chat-timestamp float-right">'+formatFecha(new Date(1e3*s.timestamp))+'</span></div><img class="direct-chat-img" src="'+i+'" alt="Message User Image"><div class="direct-chat-text" bis_skin_checked="1"><a href="https://www.google.com/maps?q='+s.lat+","+s.lng+'" target="_blank">Ubicacion, click aqui para ver</a></div></div>':"chat"==s.type?t+='<div class="direct-chat-msg" bis_skin_checked="1"><div class="direct-chat-infos clearfix" bis_skin_checked="1"><span class="direct-chat-name float-left">'+s.sender.pushname+'</span><span class="direct-chat-timestamp float-right">'+formatFecha(new Date(1e3*s.timestamp))+'</span></div><img class="direct-chat-img" src="'+i+'" alt="Message User Image"><div class="direct-chat-text" bis_skin_checked="1">'+s.body+"</div></div>":"image"==s.type?(t+='<div class="direct-chat-msg" bis_skin_checked="1"><div class="direct-chat-infos clearfix" bis_skin_checked="1"><span class="direct-chat-name float-left">'+s.sender.pushname+'</span><span class="direct-chat-timestamp float-right">'+formatFecha(new Date(1e3*s.timestamp))+'</span></div><img class="direct-chat-img" src="'+i+'" alt="Message User Image"><div class="direct-chat-text" bis_skin_checked="1"><img id="i'+s.timestamp+'" src="data:image/jpeg;base64,'+s.body+'" width="100%" alt="Imagen"></div></div>',socket.emit("media",{msg:s.id,id:"i"+s.timestamp,type:s.type,name:"null"})):"document"==s.type?(t+='<div class="direct-chat-msg" bis_skin_checked="1"><div class="direct-chat-infos clearfix" bis_skin_checked="1"><span class="direct-chat-name float-left">'+s.sender.pushname+'</span><span class="direct-chat-timestamp float-right">'+formatFecha(new Date(1e3*s.timestamp))+'</span></div><img class="direct-chat-img" src="'+i+'" alt="Message User Image"><div class="direct-chat-text" bis_skin_checked="1"><a href="javascript:waitFile()" id="i'+s.timestamp+'" class="btn btn-success">Descargar documento ('+s.filename+").</a></div></div>",socket.emit("media",{msg:s.id,id:"i"+s.timestamp,type:s.type,name:s.filename})):"ptt"==s.type?(t+='<div class="direct-chat-msg" bis_skin_checked="1"><div class="direct-chat-infos clearfix" bis_skin_checked="1"><span class="direct-chat-name float-left">'+s.sender.pushname+'</span><span class="direct-chat-timestamp float-right">'+formatFecha(new Date(1e3*s.timestamp))+'</span></div><img class="direct-chat-img" src="'+i+'" alt="Message User Image"><div class="direct-chat-text" bis_skin_checked="1"><div id="i'+s.timestamp+'"><span class="btn btn-danger">Estamos cargando el audio para que puedas escucharlo.</span></div></div></div>',socket.emit("media",{msg:s.id,id:"i"+s.timestamp,type:s.type,name:"null"})):"revoked"==s.type&&(t+='<div class="direct-chat-msg" bis_skin_checked="1"><div class="direct-chat-infos clearfix" bis_skin_checked="1"><span class="direct-chat-name float-left">'+s.sender.pushname+'</span><span class="direct-chat-timestamp float-right">'+formatFecha(new Date(1e3*s.timestamp))+'</span></div><img class="direct-chat-img" src="'+i+'" alt="Message User Image"><div class="direct-chat-text" bis_skin_checked="1">Se elimino este mensaje</div></div>')}$("#direct-chat-view").html(t).animate({scrollTop:$("#direct-chat-view").prop("scrollHeight")},500)}),socket.on("disconnect",function(){console.log("Se ha caído la conexión con el servidor de Socket.IO"),$(".status_bot").text("Sin conexión."),modal.show(),$("#edit-client-chat-view").prop("disabled",!0)});try{selectBtn.addEventListener("click",()=>{fileInput.click()}),fileInput.addEventListener("change",()=>{const e=fileInput.files[0];if($("#input-file-send").val(""),e){const t=e.name.split(".").pop().toLowerCase(),a=["pdf","jpeg","jpg","png","gif","mp3","wav"],s=new FileReader;a.includes(t)&&"0"!=chatActive?(s.onload=(()=>{const e=s.result;console.log(e),socket.emit("message",{type:"jpeg"==t||"jpg"==t||"png"==t||"gif"==t?"image":"pdf"==t?"document":"audio",phone:chatActive,body:e})}),s.readAsDataURL(e)):toastr.error("El tipo de archivo no es admitido para su envió.")}})}catch(e){}$(document).ready(function(){$("#select-delivery").change(function(){var e=$(this).val();"0"==e?($("#label-delivery-note").text("Nota exclusiva para cliente."),$("#msg-add-delivery").prop("placeholder","Nota exclusiva para cliente..."),$("#select-address").prop("disabled",!0)):($("#label-delivery-note").text("Nota exclusiva para repartidor."),$("#msg-add-delivery").prop("placeholder","Nota exclusiva para repartidor..."),$("#select-address").prop("disabled",!1))})}),$(document).ready(function(){$("#select-address").change(function(){var e=$(this).val();"-1"==e?$("#address-div-custom-temp").show():$("#address-div-custom-temp").hide()}),$("#address-div-custom-temp").hide(),$("#extra-add-client-div").hide()}),$(document).ready(function(){$("#editClient").on("hidden.bs.modal",function(){"/"!=route&&1==dataClientChange&&(window.location.href="/Client")})}),$("#resume_type_reason").change(function(){var e=$(this).val();"Otro"==e?$("#other_resume_day").removeClass("none"):$("#other_resume_day").addClass("none")});